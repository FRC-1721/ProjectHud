<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.js"></script>
  <style>
    .container {
      display: flex;
    }

    .column {
      flex: 1;
      padding: 10px;
      border: 1px solid #ddd;
      margin: 10px;
    }
  </style>
</head>

<body>
  <h1>Dashboard</h1>
  <div class="container" id="dashboard-container">
    {% for project in projects %}
    <div class="column" id="project-{{ project.id }}">
      <h2>{{ project.name }}</h2>
      <h3>Notes</h3>
      <ul id="notes-{{ project.id }}">
        {% for note in project.notes %}
        <li>{{ note.content }}</li>
        {% endfor %}
      </ul>
      <h3>Tasks</h3>
      <ul id="tasks-{{ project.id }}">
        {% for task in project.tasks %}
        <li>{{ task.description }}</li>
        {% endfor %}
      </ul>
    </div>
    {% endfor %}
  </div>
  <script>
    const socket = io();
    socket.on('message', function (data) {
      console.log(data);
    });

    function updateProject(project_id) {
      socket.emit('update', { project_id: project_id });
    }

    socket.on('update', function (data) {
      const project_id = data.project_id;
      const notesList = document.getElementById(`notes-${project_id}`);
      const tasksList = document.getElementById(`tasks-${project_id}`);

      notesList.innerHTML = '';
      data.notes.forEach(function (note) {
        const li = document.createElement('li');
        li.textContent = note;
        notesList.appendChild(li);
      });

      tasksList.innerHTML = '';
      data.tasks.forEach(function (task) {
        const li = document.createElement('li');
        li.textContent = task;
        tasksList.appendChild(li);
      });
    });

    // Optionally, poll for updates every X seconds
    setInterval(() => {
      document.querySelectorAll('.column').forEach(col => {
        const project_id = col.id.split('-')[1];
        updateProject(project_id);
      });
    }, 5);  // Adjust the interval as needed
  </script>
</body>

</html>